# Makefile for C++ Project: Encoding and Querying Large Datasets

# Compiler
CXX := g++

# Compiler Flags
CXXFLAGS := -std=c++17 -O3 -Wall -Wextra -pthread -msse4.2 -MMD -MP

# Linker Flags
LDFLAGS := -pthread -msse4.2

# Source Files
SRCS := main.cc encoder.cc query.cc vanilla_search.cc

# Header Files (Automatically detected via dependency generation)
# DEPS will be generated by the compiler with -MMD flag

# Object Files
OBJS := $(SRCS:.cc=.o)

# Dependency Files
DEPS := $(OBJS:.o=.d)

# Executable Name
TARGET := run.exe

# Default Target
all: $(TARGET)

# Link the executable
$(TARGET): $(OBJS)
	$(CXX) $(CXXFLAGS) $(OBJS) -o $(TARGET) $(LDFLAGS)

# Compile .cc files to .o files
%.o: %.cc
	$(CXX) $(CXXFLAGS) -c $< -o $@

# Include the dependency files
-include $(DEPS)

# Clean Build Artifacts
.PHONY: clean
clean:
	@echo "Cleaning build artifacts..."
	del /F /Q main.o encoder.o query.o vanilla_search.o main.d encoder.d query.d vanilla_search.d main.exe 2>nul || echo "No files to delete."

# Rebuild Completely
.PHONY: rebuild
rebuild: clean all

# Help Message
.PHONY: help
help:
	@echo "Makefile for C++ Project: Encoding and Querying Large Datasets"
	@echo ""
	@echo "Usage:"
	@echo "  make           Build the executable."
	@echo "  make clean     Remove all build artifacts."
	@echo "  make rebuild   Clean and rebuild the project."
	@echo "  make help      Display this help message."
